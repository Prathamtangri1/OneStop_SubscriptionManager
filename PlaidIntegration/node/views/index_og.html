<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>OneStop - Subscription Manager</title>
    <link rel="stylesheet" href="https://threads.plaid.com/threads.css">

    <link rel="stylesheet" type="text/css" href="./static/style.css">
    
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--====== Favicon Icon ======-->
    <link rel="shortcut icon" href="./static/assets/images/favicon.png" type="image/png">
        
    <!--====== Animate CSS ======-->
    <link rel="stylesheet" href="./static/assets/css/animate.css">
        
    <!--====== Magnific Popup CSS ======-->
    <link rel="stylesheet" href="./static/assets/css/magnific-popup.css">
        
    <!--====== Slick CSS ======-->
    <link rel="stylesheet" href="./static/assets/css/slick.css">
        
    <!--====== Line Icons CSS ======-->
    <link rel="stylesheet" href="./static/assets/css/LineIcons.css">
        
    <!--====== Font Awesome CSS ======-->
    <link rel="stylesheet" href="./static/assets/css/font-awesome.min.css">
        
    <!--====== Bootstrap CSS ======-->
    <link rel="stylesheet" href="./static/assets/css/bootstrap.min.css">
    
    <!--====== Default CSS ======-->
    <link rel="stylesheet" href="./static/assets/css/default.css">
    
    <!--====== Style CSS ======-->
    <link rel="stylesheet" href="./static/assets/css/style.css">
<link rel="stylesheet" href="https://threads.plaid.com/threads.css">

<link rel="stylesheet" type="text/css" href="./static/style.css">
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
  <main class="main">
    <div class="grid">
      <div class="grid__column grid__column--is-twelve-columns">
        <div id="container" class="initial-view">
        <!--[if IE]>
        <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
      <![endif]-->    
       
       
        <!--====== PRELOADER PART START ======-->
    
        <div class="preloader">
            <div class="loader">
                <div class="ytp-spinner">
                    <div class="ytp-spinner-container">
                        <div class="ytp-spinner-rotator">
                            <div class="ytp-spinner-left">
                                <div class="ytp-spinner-circle"></div>
                            </div>
                            <div class="ytp-spinner-right">
                                <div class="ytp-spinner-circle"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    
        <!--====== PRELOADER PART ENDS ======-->
        
        <!--====== HEADER PART START ======-->
        
        <header class="header-area">
            <!-- <div class="navbar-area">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-12">
                            <nav class="navbar navbar-expand-lg">
                                <a class="navbar-brand" href="index.html">
                                    <img src="./static/assets/images/logo.png" alt="Logo">OneStop
                                </a>
                                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                                    <span class="toggler-icon"></span>
                                    <span class="toggler-icon"></span>
                                    <span class="toggler-icon"></span>
                                </button>
    
                                
                            </nav> 
                        </div>
                    </div> 
                </div> 
            </div>  -->
            
            <div id="home" class="header-hero bg_cover" style="background-image: url(./static/assets/images/banner-bg.svg)">
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-lg-8">
                            <div class="header-hero-content text-center">
                                <h3 class="header-sub-title wow fadeInUp" data-wow-duration="1.3s" data-wow-delay="0.2s">
                                    <img src="./static/assets/images/logo (another copy).png" alt="Logo">
                                OneStop</h3>
                                <h2 class="header-title wow fadeInUp" data-wow-duration="1.3s" data-wow-delay="0.5s">Get rid of subscription anxiety</h2>
                                <p class="text wow fadeInUp" data-wow-duration="1.3s" data-wow-delay="0.8s">Manage and configure all your subscriptions at a single place. View useful statistics and get on top of all subscriptions' schedules. Just connect your bank account and our tool does everything else automatically!</p>
                                <!-- <a href="#" class="main-btn wow fadeInUp" data-wow-duration="1.3s" data-wow-delay="1.1s"></a> -->
                                <button id="link-btn" class="button button--is-primary main-btn wow fadeInUp" data-wow-duration="1.3s" data-wow-delay="1.1s">Get Started</button>
                                <div class="loading-indicator"></div>
                            </div> <!-- header hero content -->
                        </div>
                    </div> <!-- row -->
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="header-hero-image text-center wow fadeIn" data-wow-duration="1.3s" data-wow-delay="1.4s">
                                <img src="./static/assets/images/about3.svg" alt="hero">
                            </div> 
                        </div>
                    </div> 
                </div> <!-- container -->
                <div id="particles-1" class="particles"></div>
            </div> <!-- header hero -->
        </header>
        
        <!--====== HEADER PART ENDS ======-->
        
        <!--====== SERVICES PART START ======-->
        
        <section id="features" class="services-area pt-120">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-10">
                        <div class="section-title text-center pb-40">
                            <div class="line m-auto"></div>
                            <h3 class="title">Clean and simple design, <span> Comes with everything you need!</span></h3>
                        </div> <!-- section title -->
                    </div>
                </div> <!-- row -->
                <div class="row justify-content-center">
                    <div class="col-lg-4 col-md-7 col-sm-8">
                        <div class="single-services text-center mt-30 wow fadeIn" data-wow-duration="1s" data-wow-delay="0.2s">
                            <div class="services-icon">
                                <img class="shape" src="./static/assets/images/services-shape.svg" alt="shape">
                                <img class="shape-1" src="./static/assets/images/services-shape-1.svg" alt="shape">
                                <i class="lni-baloon"></i>
                            </div>
                            <div class="services-content mt-30">
                                <h4 class="services-title"><a href="#">Clean</a></h4>
                                <p class="text">View all useful information including about every subscription at a glance, including the upcoming payments</p>
                            </div>
                        </div> <!-- single services -->
                    </div>
                    <div class="col-lg-4 col-md-7 col-sm-8">
                        <div class="single-services text-center mt-30 wow fadeIn" data-wow-duration="1s" data-wow-delay="0.5s">
                            <div class="services-icon">
                                <img class="shape" src="./static/assets/images/services-shape.svg" alt="shape">
                                <img class="shape-1" src="./static/assets/images/services-shape-2.svg" alt="shape">
                                <i class="lni-cog"></i>
                            </div>
                            <div class="services-content mt-30">
                                <h4 class="services-title"><a href="#">Robust</a></h4>
                                <p class="text">Gathers subscriptions and their related information from all your accounts automatically. </p>
                                
                            </div>
                        </div> <!-- single services -->
                    </div>
                    <div class="col-lg-4 col-md-7 col-sm-8">
                        <div class="single-services text-center mt-30 wow fadeIn" data-wow-duration="1s" data-wow-delay="0.8s">
                            <div class="services-icon">
                                <img class="shape" src="./static/assets/images/services-shape.svg" alt="shape">
                                <img class="shape-1" src="./static/assets/images/services-shape-3.svg" alt="shape">
                                <i class="lni-bolt-alt"></i>
                            </div>
                            <div class="services-content mt-30">
                                <h4 class="services-title"><a href="#">Powerful</a></h4>
                                <p class="text">See detailed statistics related to the financial activity due to recurrent transactions. </p>
                                
                            </div>
                        </div> <!-- single services -->
                    </div>
                </div> <!-- row -->
            </div> <!-- container -->
        </section>
        
        <!--====== SERVICES PART ENDS ======-->
        
        
        
        <!--====== FOOTER PART START ======-->
        
        <footer id="footer" class="footer-area pt-120">
            <div class="container">
                <div class="footer-widget pb-100">
                    <div class="row">
                        <div class="col-lg-4 col-md-6 col-sm-8">
                            <div class="footer-about mt-50 wow fadeIn" data-wow-duration="1s" data-wow-delay="0.2s">
                                <a class="logo" href="#">
                                    
                                    <h2 class="header-sub-title wow fadeInUp" data-wow-duration="1.3s" data-wow-delay="0.2s" style="color: white;">
                                    OneStop </h2>
                                </a>
                                <p class="text">A one stop solution to all your subscriptions problems</p>
                                <ul class="social">
                                    <li><a href="#"><i class="lni-facebook-filled"></i></a></li>
                                    <li><a href="#"><i class="lni-twitter-filled"></i></a></li>
                                    <li><a href="#"><i class="lni-instagram-filled"></i></a></li>
                                    <li><a href="#"><i class="lni-linkedin-original"></i></a></li>
                                </ul>
                            </div> <!-- footer about -->
                        </div>
                    </div> <!-- row -->
                </div> <!-- footer widget -->
                <div class="footer-copyright">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="copyright d-sm-flex justify-content-between">
                                <div class="copyright-content">
                                    <p class="text">Step Up Bootcamp Project by Team 3</a></p>
                                </div> <!-- copyright content -->
                            </div> <!-- copyright -->
                        </div>
                    </div> <!-- row -->
                </div> <!-- footer copyright -->
            </div> <!-- container -->
            <div id="particles-2"></div>
        </footer>
        
        <!--====== FOOTER PART ENDS ======-->
        
        <!--====== BACK TOP TOP PART START ======-->
    
        <a href="#" class="back-to-top"><i class="lni-chevron-up"></i></a>
    
        <!--====== BACK TOP TOP PART ENDS ======-->   
        
        <!--====== PART START ======-->
        
    <!--
        <section class="">
            <div class="container">
                <div class="row">
                    <div class="col-lg-"></div>
                </div>
            </div>
        </section>
    -->
        
        <!--====== PART ENDS ======-->
      </div></div>
    </div>
  </main>
  <!--====== Jquery js ======-->
<script src="./static/assets/js/vendor/jquery-1.12.4.min.js"></script>
<script src="./static/assets/js/vendor/modernizr-3.7.1.min.js"></script>

<!--====== Bootstrap js ======-->
<script src="./static/assets/js/popper.min.js"></script>
<script src="./static/assets/js/bootstrap.min.js"></script>

<!--====== Plugins js ======-->
<script src="./static/assets/js/plugins.js"></script>

<!--====== Slick js ======-->
<script src="./static/assets/js/slick.min.js"></script>

<!--====== Ajax Contact js ======-->
<script src="./static/assets/js/ajax-contact.js"></script>

<!--====== Counter Up js ======-->
<script src="./static/assets/js/waypoints.min.js"></script>
<script src="./static/assets/js/jquery.counterup.min.js"></script>

<!--====== Magnific Popup js ======-->
<script src="./static/assets/js/jquery.magnific-popup.min.js"></script>

<!--====== Scrolling Nav js ======-->
<script src="./static/assets/js/jquery.easing.min.js"></script>
<script src="./static/assets/js/scrolling-nav.js"></script>

<!--====== wow js ======-->
<script src="./static/assets/js/wow.min.js"></script>

<!--====== Particles js ======-->
<script src="./static/assets/js/particles.min.js"></script>

<!--====== Main js ======-->
<script src="./static/assets/js/main.js"></script> 


  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
  <script src="https://cdn.plaid.com/link/v2/stable/link-initialize.js"></script>
  <script>
  function render_page($, page_info) {
    // Handles redirect from the oauth response page for the oauth flow.
    if (document.referrer != null && document.referrer.includes('http://localhost:8000/oauth-response.html') && page_info.item_id != null && page_info.item_id.length > 0) {
      $('#container').fadeOut('fast', function() {
        $('#item_id').text(page_info.item_id);
        $('#access_token').text(page_info.access_token);
        $('#intro').hide();
        // $('#app, #steps').fadeIn('slow');
        console.log("Came here 1");
        window.location.replace("http://localhost:3000");
      });
    }

    var products = page_info.products;
    if (products.includes('assets')) {
      $('#assets').show();
    }
    // This functionality is only relevant for the UK Payment Initiation product.
    if (products.includes('payment_initiation')) {
      $('.payment_initiation').show();
      $.post('/api/create_link_token_for_payment', {}, function(data) {
        if (data.error != null) {
            $('.loading-indicator').hide();
            displayError($('#container'), data.error);
            return;
        }
        localStorage.setItem('link_token', data.link_token);
        // In the case of payment_initiation product, we need to wait for a
        // link token configured with payment initiation to be generated before
        // the Link handler can be initialized.
        handler = Plaid.create({
          token: data.link_token,
          onSuccess: function(public_token) {
            // This public token exchange step is not relevant for the
            // payment_initiation product and should be skipped.
            $.post('/api/set_access_token', {
              public_token: public_token
            }, function(data) {
              $('#container').fadeOut('fast', function() {
                $('#item_id').text(data.item_id);
                $('#access_token').text(data.access_token);
                $('#intro').hide();
                // $('#app, #steps').fadeIn('slow');
                console.log("Came here 2");
                window.location.replace("http://localhost:3000");
              });
            });
          },
        });
        $('#link-btn').attr('disabled', false);
        $('.loading-indicator').hide();
      });
    } else {
      var handler = null;
      $.post('/api/create_link_token', {}, function(data){
        if (data.error != null) {
            $('.loading-indicator').hide();
            displayError($('#container'), data.error);
            return;
        }
        localStorage.setItem('link_token', data.link_token);
        handler = Plaid.create({
          token: data.link_token,
          onSuccess: function(public_token) {
            $.post('/api/set_access_token', {
              public_token: public_token
            }, function(data) {
              $('#container').fadeOut('fast', function() {
                $('#item_id').text(data.item_id);
                $('#access_token').text(data.access_token);
                $('#intro').hide();
                // $('#app, #steps').fadeIn('slow');
                console.log("Came here 3");
                window.location.replace("http://localhost:3000");
              });
            });
          },
        });
        $('#link-btn').attr('disabled', false);
        $('.loading-indicator').hide();
      });
    }

    var accessToken = qs('access_token');
    if (accessToken != null && accessToken !== '') {
      $.post('/api/set_access_token', {
        access_token: accessToken
      }, function(data) {
        $('#container').fadeOut('fast', function() {
          $('#item_id').text(data.item_id);
          $('#access_token').text(accessToken);
          $('#intro').hide();
          // $('#app, #steps').fadeIn('slow');
          console.log("Came here 4");
          window.location.replace("http://localhost:3000");
        });
      });
    }

    $('#link-btn').on('click', function(e) {
      if (handler != null) {
        handler.open();
      }
    });

    $('#get-accounts-btn').on('click', function(e) {
      $.get('/api/accounts', function(data) {

        $('#get-accounts-data').slideUp(function() {
          if (data.error != null) {
            displayError(this, data.error);
            return;
          }
          var html = '<tr><td><strong>Name</strong></td><td><strong>Balances</strong></td><td><strong>Subtype</strong></td><td><strong>Mask</strong></td></tr>';
          data.accounts.forEach(function(account, idx) {
            html += '<tr>';
            html += '<td>' + account.name + '</td>';
            html += '<td>$' + (account.balances.available != null ? account.balances.available : account.balances.current) + '</td>';
            html += '<td>' + account.subtype + '</td>';
            html += '<td>' + account.mask + '</td>';
            html += '</tr>';
          });

          $(this).html(html).slideDown();
        });
      });
    });

    $('#get-auth-btn').on('click', function(e) {
      $.get('/api/auth', function(data) {
        $('#get-auth-data').slideUp(function() {
          if (data.error != null) {
            displayError(this, data.error);
            return;
          }
          var isAch = data.numbers.ach.length > 0;
          var routingLabel = isAch ? 'Routing #' : 'Institution and Branch #';

          var html = '<tr><td><strong>Name</strong></td><td><strong>Balance</strong></td><td><strong>Account #</strong></td><td><strong>'+ routingLabel +'</strong></td></tr>';
          if (isAch) {
            data.numbers.ach.forEach(function(achNumbers, idx) {
              // Find the account associated with this set of account and routing numbers
              var account = data.accounts.filter(function(a) {
                return a.account_id === achNumbers.account_id;
              })[0];
              html += '<tr>';
              html += '<td>' + account.name + '</td>';
              html += '<td>$' + (account.balances.available != null ? account.balances.available : account.balances.current) + '</td>';
              html += '<td>' + achNumbers.account + '</td>';
              html += '<td>' + achNumbers.routing + '</td>';
              html += '</tr>';
            });
          } else {
            data.numbers.eft.forEach(function(eftNumber, idx) {
              // Find the account associated with this set of account and routing numbers
              var account = data.accounts.filter(function(a) {
                return a.account_id === eftNumber.account_id;
              })[0];
              html += '<tr>';
              html += '<td>' + account.name + '</td>';
              html += '<td>$' + (account.balances.available != null ? account.balances.available : account.balances.current) + '</td>';
              html += '<td>' + eftNumber.account + '</td>';
              html += '<td>' + eftNumber.institution + ' ' + eftNumber.branch + '</td>';
              html += '</tr>';
            });
          }
          $(this).html(html).slideDown();
        });
      });
    });

    $('#get-identity-btn').on('click', function(e) {
      $.get('/api/identity', function(data) {
        $('#get-identity-data').slideUp(function() {
          if (data.error != null) {
            displayError(this, data.error);
            return;
          }
          var html = '<tr class="response-row response-row--is-identity"><td><strong>Names</strong></td><td><strong>Emails</strong></td><td><strong>Phone numbers</strong></td><td><strong>Addresses</strong></td></tr><tr class="response-row response-row--is-identity">';
          var identityData = data.identity[0];
          var html = '<tr class="response-row response-row--is-identity"><td><strong>Names</strong></td><td><strong>Emails</strong></td><td><strong>Phone numbers</strong></td><td><strong>Addresses</strong></td></tr><tr class="response-row response-row--is-identity">';

          identityData.owners.forEach(function(owner, idx) {
            html += '<td>';
            owner.names.forEach(function(name, idx) {
              html += name + '<br />';
            });
            html += '</td><td>';
            owner.emails.forEach(function(email, idx) {
              html += email.data + '<br />';
            });
            html += '</td><td>';
            owner.phone_numbers.forEach(function(number, idx) {
              html += number.data + '<br />';
            });
            html += '</td><td>';
            owner.addresses.forEach(function(address, idx) {
              html += address.data.street + '<br />';
              html += address.data.city + ', ' + address.data.region + ' ' + address.data.postal_code + '<br />';
            });
            html += '</td>';
            html += '</tr>';

          });

          $(this).html(html).slideDown();
        });
      });
    });

    $('#get-item-btn').on('click', function(e) {
      $.get('/api/item', function(data) {
        $('#get-item-data').slideUp(function() {
          if (data.error != null) {
            displayError(this, data.error);
            return;
          }
          var html = '';
          html += '<tr><td>Institution name</td><td>' + data.institution.name + '</td></tr>';
          html += '<tr><td>Billed products</td><td>' + data.item.billed_products.join(', ') + '</td></tr>';
          html += '<tr><td>Available products</td><td>' + data.item.available_products.join(', ') + '</td></tr>';

          $(this).html(html).slideDown();
        });
      });
    });

    $('#get-transactions-btn').on('click', function(e) {
      $.get('/api/transactions', function(data) {
        if (data.error != null && data.error.error_code != null) {
          // Format the error
          var errorHtml = '<div class="inner"><p>' +
           '<strong>' + data.error.error_code + ':</strong> ' +
           (data.error.display_message == null ? data.error.error_message : data.error.display_message)  + '</p></div>';

          if (data.error.error_code === 'PRODUCT_NOT_READY') {
            // Add additional context for `PRODUCT_NOT_READY` errors
            errorHtml += '<div class="inner"><p>Note: The PRODUCT_NOT_READY ' +
             'error is returned when a request to retrieve Transaction data ' +
             'is made before Plaid finishes the <a href="https://plaid.com/' +
             'docs/quickstart/#transaction-data-with-webhooks">initial ' +
             'transaction pull.</a></p></div>';
          }
          // Render the error
          $('#get-transactions-data').slideUp(function() {
            $(this).slideUp(function() {
              $(this).html(errorHtml).slideDown();
            });
          });
          return;
        }
        $('#get-transactions-data').slideUp(function () {
          var html = '<tr><td><strong>Name</strong></td><td><strong>Amount</strong></td><td><strong>Date</strong></td></tr>';
          data.transactions.forEach(function (txn, idx) {
            html += '<tr>';
            html += '<td>' + txn.name + '</td>';
            html += '<td>$' + txn.amount + '</td>';
            html += '<td>' + txn.date + '</td>';
            html += '</tr>';
          });

          $(this).slideUp(function () {
            $(this).html(html).slideDown();
          });
        });
      });
    });

    $('#get-balance-btn').on('click', function(e) {
      $.get('/api/balance', function(data) {
        $('#get-balance-data').slideUp(function() {
          if (data.error != null) {
            displayError(this, data.error);
            return;
          }
          var html = '<tr><td><strong>Name</strong></td><td><strong>Balance</strong></td><td><strong>Subtype</strong></td><td><strong>Mask</strong></td></tr>';
          data.accounts.forEach(function(account, idx) {
            html += '<tr>';
            html += '<td>' + account.name + '</td>';
            html += '<td>$' + (account.balances.available != null ? account.balances.available : account.balances.current) + '</td>'
            html += '<td>' + account.subtype + '</td>';
            html += '<td>' + account.mask + '</td>';
            html += '</tr>';
          });

          $(this).html(html).slideDown();
        });
      });
    });

    $('#get-holdings-btn').on('click', function(e) {
      $.get('/api/holdings', function(data) {
        $('#get-holdings-data').slideUp(function() {
          if (data.error != null) {
            displayError(this, data.error);
            return;
          }
          // Organize by Account
          var holdingsData = data.holdings.holdings.sort(function(a, b) {
            if (a.account_id > b.account_id) return 1;
            return -1;
          });
          var html = '<tr class="response-row response-row--is-holdings"></tr><td><strong>Account Mask</strong></td><td><strong>Name</strong></td><td><strong>Quantity</strong></td><td><strong>Close Price</strong></td><td><strong>Value</strong></td><tr class="response-row response-row--is-holding">';
          holdingsData.forEach(function(h, idx) {
            const account = data.holdings.accounts.filter(a => a.account_id === h.account_id)[0];
            const security = data.holdings.securities.filter(s => s.security_id === h.security_id)[0];
            if (account == null) {
              displayError(this, {
                code: 500,
                type: 'Internal',
                display_message: 'Holding lacks a account',
              });
            }
            if (security == null) {
              displayError(this, {
                code: 500,
                type: 'Internal',
                display_message: 'Holding lacks a security',
              });
            }
            html += '<tr>';
            html += '<td>' + account.mask + '</td>';
            html += '<td>' + security.name + '</td>';
            html += '<td>' + h.quantity + '</td>';
            html += '<td>$' + security.close_price + '</td>';
            html += '<td>$' + h.quantity * security.close_price + '</td>';
            html += '</tr>';
          });
          $(this).html(html).slideDown();
        });
      });
    });

    $('#get-investment-transactions-btn').on('click', function(e) {
      $.get('/api/investment_transactions', function(data) {
        $('#get-investment-transactions-data').slideUp(function() {
          if (data.error != null) {
            displayError(this, data.error);
            return;
          }
          investmentTransactionData = data.investment_transactions.investment_transactions;
          var html = '<tr class="response-row response-row--is-investment-transactions"></tr><td><strong>Name</strong></td><td><strong>Amount</strong></td><td><strong>Date</strong></td><tr class="response-row response-row--is-investment-transaction">';
          investmentTransactionData.forEach(function(invTxn, idx) {
            html += '<tr>';
            html += '<td>' + invTxn.name + '</td>';
            html += '<td>$' + invTxn.amount + '</td>';
            html += '<td>' + invTxn.date + '</td>';
            html += '</tr>';
          });
          $(this).html(html).slideDown();
        });
      });
    });

    $('#get-assets-btn').on('click', function(e) {
      $.get('/api/assets', function(data) {
        $('#get-assets-data').slideUp(function() {
          if (data.error != null) {
            displayError(this, data.error);
            return;
          }
          var reportData = data.json;
          var html = `
          <tr>
            <td><strong>Account</strong></td>
            <td><strong>Balance</strong></td>
            <td><strong># Transactions</strong></td>
            <td><strong># Days Available</strong></td>
          </tr>`;
          reportData.items.forEach(function(item, itemIdx) {
            item.accounts.forEach(function(account, accountIdx) {
              html += '<tr>';
              html += '<td>' + account.name + '</td>';
              html += '<td>$' + account.balances.current + '</td>'
              html += '<td>' + account.transactions.length + '</td>';
              html += '<td>' + account.days_available + '</td>';
              html += '</tr>';
            });
          });

          $('#download-assets-pdf-btn')
            .attr('href', `data:application/pdf;base64,${data.pdf}`)
            .attr('download', 'Asset Report.pdf')
            .show();

          $(this).html(html).slideDown();
        });
      });
    });

    // This functionality is only relevant for the UK Payment Initiation product.
    $('#get-payment-btn').on('click', function(e) {
      $.get('/api/payment', function(data) {
        $('#get-payment-data').slideUp(function() {
          if (data.error != null) {
            displayError(this, data.error);
            return;
          }
          var paymentData = data.payment;
          var html = '';
          html += '<tr><td>Payment ID</td><td>' + paymentData.payment_id + '</td></tr>';
          html += '<tr><td>Amount</td><td>' + (paymentData.amount.currency + ' ' + paymentData.amount.value) + '</td></tr>';
          html += '<tr><td>Status</td><td>' + paymentData.status + '</td></tr>';
          html += '<tr><td>Last Status Update</td><td>' + paymentData.last_status_update + '</td></tr>';
          html += '<tr><td>Recipient ID</td><td>' + paymentData.recipient_id + '</td></tr>';
          $(this).html(html).slideDown();
        });
      });
    });
  }
  $.post('/api/info', {}, function(result) {
    render_page(jQuery, result);
  });

function qs(key) {
    key = key.replace(/[*+?^$.\[\]{}()|\\\/]/g, "\\$&"); // escape RegEx meta chars
    var match = location.search.match(new RegExp("[?&]"+key+"=([^&]+)(&|$)"));
    return match && decodeURIComponent(match[1].replace(/\+/g, " "));
}

function displayError(element, error) {
  var html = `
    <div class="alert alert-danger">
      <p><strong>Error Code:</strong> ${error.error_code}</p>
      <p><strong>Error Type:</strong> ${error.error_type}</p>
      <p><strong>Error Message:</strong> ${error.display_message == null ? error.error_message : error.display_message}</p>
      <div>Check out our <a href="https://plaid.com/docs/#errors-overview">errors documentation</a> for more information.</div>
    </div>`;
  $(element).html(html).slideDown();
}
  </script>
</body>
</html>
